#VRML_SIM R2025a utf8

EXTERNPROTO "https://raw.githubusercontent.com/cyberbotics/webots/R2023b/projects/objects/backgrounds/protos/TexturedBackground.proto"
EXTERNPROTO "https://raw.githubusercontent.com/cyberbotics/webots/R2023b/projects/objects/backgrounds/protos/TexturedBackgroundLight.proto"
EXTERNPROTO "https://raw.githubusercontent.com/cyberbotics/webots/R2023b/projects/objects/floors/protos/Floor.proto"
EXTERNPROTO "https://raw.githubusercontent.com/cyberbotics/webots/R2023b/projects/appearances/protos/Grass.proto"
EXTERNPROTO "https://raw.githubusercontent.com/cyberbotics/webots/R2023b/projects/objects/factory/manhole/protos/SquareManhole.proto"
IMPORTABLE EXTERNPROTO "../protos/IrisSimple.proto"

WorldInfo {
  title "Lidar Test"
  basicTimeStep 2
  FPS 20
}
Viewpoint {
  orientation 0.028363339622224835 -0.9981822757472139 -0.05317579665212045 5.301673552943007
  position -15.587707190660662 -7.548547887879861 15.221757217483317
  follow "Iris"
  followSmoothness 0.01
}
TexturedBackground {
}
TexturedBackgroundLight {
}
Floor {
  size 30 30
  appearance Grass {
  }
}
SquareManhole {
  translation 0 0 0
  name "drone takeoff"
  size 0.5 0.5 0.1
}
DEF Iris IrisSimple {
  translation 0 0 0.13
  rotation 0 0 1 0
  controller "ardupilot_sitl_controller"
  controllerArgs [
    "--motors"
    "m1_motor, m2_motor, m3_motor, m4_motor"
    # "--camera"
    # "camera"
    # "--camera-port"
    # "5599"
    "--lidar"
    "Lidar"
    "--lidar-fps"
    "10"
  ]
  extensionSlot [
    Lidar {
      translation 0 0 -0.25
      rotation 0 0 1 0
      name "Lidar"
      horizontalResolution 150
      fieldOfView 6.28318
      verticalFieldOfView 3.14159
      numberOfLayers 30
      minRange 0.05
      maxRange 15
      noise 0.01
    }

    # DEF camera Camera {
    #   translation 0.08 0 0
    #   rotation 0 1 0 1.57
    #   width 640
    #   height 480
    # }
  ]
}
# Wall (Ghost - No physics collision)
Solid {
  translation 3 0 1.5
  children [
    Shape {
      appearance PBRAppearance {
        baseColor 0.8 0.8 0.7
        roughness 0.95
        transparency 0.3  # Make it look somewhat ghostly
      }
      geometry Box {
        size 0.2 10.0 3.0  # Make it a long wall along Y axis (x=3)
      }
    }
  ]
  name "wall"
  # No boundingObject -> No collision (Ghost)
}
